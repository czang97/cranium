---
title: "ErrorB Correction"
author: "Ziwei Crystal Zang"
date: "9/30/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(spatstat.utils)
library(mosaic)
library(cranium)

library(dplyr)
library(broom)
library(tidyverse)
library(gridExtra)
library(mosaic)
```

# new functions
```{r}
print_one_plot <- function(x = ro_brain_yt_1, title = "Sample Plot"){
    setwd("/Users/czang/Documents/cranium/sample_plot/correctionB/youtoo_2")
    wd <- getwd()
    png(paste(wd, "/",title, ".png", sep=""), width = 900, height = 300)
    plot2d(x , title = title) #output image with dimension: 900*300
    dev.off()
}   
```


```{r}
#access PCA reoriented data for youtoo and wildtype
ro_brain_ls_yt <- readRDS(file = "/Users/czang/Desktop/processed_sample/ro_brain_ls_yt.rds") 

ro_brain_ls_wt <- readRDS(file = "/Users/czang/Desktop/processed_sample/ro_brain_ls_wt.rds")

#plot all samples 
#plot_all_sample(x=ro_brain_ls_wt ,type = "wildtype", wd = "/Users/czang/Documents/cranium/")
#plot_all_sample(x=ro_brain_ls_yt , type = "youtoo", wd = "/Users/czang/Documents/cranium/")
```

# start with one sample: youtoo 2
```{r}
#selecting sample from the list
#ro_brain_yt_3 <- ro_brain_ls_yt[[3]]
ro_brain_yt <- ro_brain_ls_yt[[2]]

plot2d(ro_brain_yt , title = "Youtoo Sample #1 - After PCA-step 1") #output image with dimension: 900*300

print_one_plot(x = ro_brain_yt, title = "Youtoo Sample #2 - After PCA-step 1")
```

#check for error A and make correction
```{r}
is_errorA(ro_brain_yt)

cA_ro_brain_yt <- correct_errorA(ro_brain_yt, threshold.n=0.5)

is_errorA(cA_ro_brain_yt)

plot2d(cA_ro_brain_yt , title = "Youtoo Sample #2 - After correction for errorA-step 2") #output image with dimension: 900*300

print_one_plot(x = cA_ro_brain_yt,  title = "Youtoo Sample #2 - After correction for errorA-step 2")
```

#Function: correct_errorB
```{r}
#ro_data <- cA_ro_brain_yt

cB_brain_yt <- correct_errorB.tbl_brain(cA_ro_brain_yt)
print_one_plot(x = cB_brain_yt,  title = "Youtoo Sample #2 - After 1 correction for errorB-step 3")


cB2_brain_yt <- correct_errorB.tbl_brain(cB_brain_yt)
print_one_plot(x = cB2_brain_yt,  title = "Youtoo Sample #2 - After 2 corrections for errorB-step 4")

cB3_brain_yt <- correct_errorB.tbl_brain(cB2_brain_yt)
print_one_plot(x = cB3_brain_yt,  title = "Youtoo Sample #2 - After 3 corrections for errorB-step 5")


cB4_brain_yt <- correct_errorB.tbl_brain(cB3_brain_yt)
print_one_plot(x = cB4_brain_yt,  title = "Youtoo Sample #2 - After 4 corrections for errorB-step 6")



cB5_brain_yt <- correct_errorB.tbl_brain(cB4_brain_yt)
print_one_plot(x = cB5_brain_yt,  title = "Youtoo Sample #2 - After 5 corrections for errorB-step 7")


cB6_brain_yt <- correct_errorB.tbl_brain(cB5_brain_yt)
print_one_plot(x = cB6_brain_yt,  title = "Youtoo Sample #2 - After 6 corrections for errorB-step 8")


cB7_brain_yt <- correct_errorB.tbl_brain(cB6_brain_yt)
print_one_plot(x = cB7_brain_yt,  title = "Youtoo Sample #2 - After 7 corrections for errorB-step 9")

is_errorB.tbl_brain(cB8_brain_yt)
```


# pipeline
```{r}
#start with brain data that is tidied and pca reoriented
ro_brain_yt <- ro_brain_ls_yt[[2]]


pipeline <- function(x = ro_brain_yt){
  #check for error A
  is_errorA(ro_brain_yt)

  cA_ro_brain_yt <- correct_errorA(ro_brain_yt, threshold.n=0.5)

}
```


